// Copyright (c) Sphere 10 Software. All rights reserved. (https://sphere10.com)
// Author: Herman Schoenfeld
//
// Distributed under the MIT software license, see the accompanying file
// LICENSE or visit http://www.opensource.org/licenses/mit-license.php.
//
// This notice must not be removed when duplicating this file or its contents, in whole or in part.

using NUnit.Framework;
using Hydrogen;
using Hydrogen.DApp.Core.Maths;

namespace VelocityNET.Processing.Tests.Core;

public class MolinaTargetTests {


	[Test]
	public void Basic() {
		var targetAlg = new MolinaTargetAlgorithm();
		var expected = targetAlg.MinCompactTarget;
		var target = targetAlg.ToDigest(expected);
		var actual = targetAlg.FromDigest(target);
		Assert.AreEqual(expected, actual);
	}

	[Test]
	public void PascalCoinCompatibility() {

		void Check(string hexBytes, string expectedTarget, uint expectedCompactTarget) {
			var targetAlg = new MolinaTargetAlgorithm();
			var bytes = HexEncoding.Decode(new string(hexBytes));
			var compact = targetAlg.FromDigest(bytes);
			var target = targetAlg.ToDigest(compact);
			Assert.AreEqual(HexEncoding.Decode(expectedTarget), target);
			Assert.AreEqual(expectedCompactTarget, compact);

		}

		Check("0x0000000000000000000000000000000000000000000000000000000000000000", "0x0000000000000000000000000000000000000000000000000000000001000000", 3892314111);
		Check("0x000000000000000000000000000000000000000000000000000000000000000f", "0x000000000000000000000000000000000000000000000000000000000100000f", 3892314096);
		Check("0x00000000000000000000000000000000000000000000000000000000000000ff", "0x00000000000000000000000000000000000000000000000000000000010000ff", 3892313856);
		Check("0x0000000000000000000000000000000000000000000000000000000000000fff", "0x0000000000000000000000000000000000000000000000000000000001000fff", 3892310016);
		Check("0x000000000000000000000000000000000000000000000000000000000000ffff", "0x000000000000000000000000000000000000000000000000000000000100ffff", 3892248576);
		Check("0x00000000000000000000000000000000000000000000000000000000000fffff", "0x00000000000000000000000000000000000000000000000000000000010fffff", 3891265536);
		Check("0x0000000000000000000000000000000000000000000000000000000000ffffff", "0x0000000000000000000000000000000000000000000000000000000001ffffff", 3875536896);
		Check("0x000000000000000000000000000000000000000000000000000000000fffffff", "0x000000000000000000000000000000000000000000000000000000000ffffff8", 3825205248);
		Check("0x00000000000000000000000000000000000000000000000000000000ffffffff", "0x00000000000000000000000000000000000000000000000000000000ffffff80", 3758096384);
		Check("0x0000000000000000000000000000000000000000000000000000000fffffffff", "0x0000000000000000000000000000000000000000000000000000000ffffff800", 3690987520);
		Check("0x000000000000000000000000000000000000000000000000000000ffffffffff", "0x000000000000000000000000000000000000000000000000000000ffffff8000", 3623878656);
		Check("0x00000000000000000000000000000000000000000000000000000fffffffffff", "0x00000000000000000000000000000000000000000000000000000ffffff80000", 3556769792);
		Check("0x0000000000000000000000000000000000000000000000000000ffffffffffff", "0x0000000000000000000000000000000000000000000000000000ffffff800000", 3489660928);
		Check("0x000000000000000000000000000000000000000000000000000fffffffffffff", "0x000000000000000000000000000000000000000000000000000ffffff8000000", 3422552064);
		Check("0x00000000000000000000000000000000000000000000000000ffffffffffffff", "0x00000000000000000000000000000000000000000000000000ffffff80000000", 3355443200);
		Check("0x0000000000000000000000000000000000000000000000000fffffffffffffff", "0x0000000000000000000000000000000000000000000000000ffffff800000000", 3288334336);
		Check("0x000000000000000000000000000000000000000000000000ffffffffffffffff", "0x000000000000000000000000000000000000000000000000ffffff8000000000", 3221225472);
		Check("0x00000000000000000000000000000000000000000000000fffffffffffffffff", "0x00000000000000000000000000000000000000000000000ffffff80000000000", 3154116608);
		Check("0x0000000000000000000000000000000000000000000000ffffffffffffffffff", "0x0000000000000000000000000000000000000000000000ffffff800000000000", 3087007744);
		Check("0x000000000000000000000000000000000000000000000fffffffffffffffffff", "0x000000000000000000000000000000000000000000000ffffff8000000000000", 3019898880);
		Check("0x00000000000000000000000000000000000000000000ffffffffffffffffffff", "0x00000000000000000000000000000000000000000000ffffff80000000000000", 2952790016);
		Check("0x0000000000000000000000000000000000000000000fffffffffffffffffffff", "0x0000000000000000000000000000000000000000000ffffff800000000000000", 2885681152);
		Check("0x000000000000000000000000000000000000000000ffffffffffffffffffffff", "0x000000000000000000000000000000000000000000ffffff8000000000000000", 2818572288);
		Check("0x00000000000000000000000000000000000000000fffffffffffffffffffffff", "0x00000000000000000000000000000000000000000ffffff80000000000000000", 2751463424);
		Check("0x0000000000000000000000000000000000000000ffffffffffffffffffffffff", "0x0000000000000000000000000000000000000000ffffff800000000000000000", 2684354560);
		Check("0x000000000000000000000000000000000000000fffffffffffffffffffffffff", "0x000000000000000000000000000000000000000ffffff8000000000000000000", 2617245696);
		Check("0x00000000000000000000000000000000000000ffffffffffffffffffffffffff", "0x00000000000000000000000000000000000000ffffff80000000000000000000", 2550136832);
		Check("0x0000000000000000000000000000000000000fffffffffffffffffffffffffff", "0x0000000000000000000000000000000000000ffffff800000000000000000000", 2483027968);
		Check("0x000000000000000000000000000000000000ffffffffffffffffffffffffffff", "0x000000000000000000000000000000000000ffffff8000000000000000000000", 2415919104);
		Check("0x00000000000000000000000000000000000fffffffffffffffffffffffffffff", "0x00000000000000000000000000000000000ffffff80000000000000000000000", 2348810240);
		Check("0x0000000000000000000000000000000000ffffffffffffffffffffffffffffff", "0x0000000000000000000000000000000000ffffff800000000000000000000000", 2281701376);
		Check("0x000000000000000000000000000000000fffffffffffffffffffffffffffffff", "0x000000000000000000000000000000000ffffff8000000000000000000000000", 2214592512);
		Check("0x00000000000000000000000000000000ffffffffffffffffffffffffffffffff", "0x00000000000000000000000000000000ffffff80000000000000000000000000", 2147483648);
		Check("0x0000000000000000000000000000000fffffffffffffffffffffffffffffffff", "0x0000000000000000000000000000000ffffff800000000000000000000000000", 2080374784);
		Check("0x000000000000000000000000000000ffffffffffffffffffffffffffffffffff", "0x000000000000000000000000000000ffffff8000000000000000000000000000", 2013265920);
		Check("0x00000000000000000000000000000fffffffffffffffffffffffffffffffffff", "0x00000000000000000000000000000ffffff80000000000000000000000000000", 1946157056);
		Check("0x0000000000000000000000000000ffffffffffffffffffffffffffffffffffff", "0x0000000000000000000000000000ffffff800000000000000000000000000000", 1879048192);
		Check("0x000000000000000000000000000fffffffffffffffffffffffffffffffffffff", "0x000000000000000000000000000ffffff8000000000000000000000000000000", 1811939328);
		Check("0x00000000000000000000000000ffffffffffffffffffffffffffffffffffffff", "0x00000000000000000000000000ffffff80000000000000000000000000000000", 1744830464);
		Check("0x0000000000000000000000000fffffffffffffffffffffffffffffffffffffff", "0x0000000000000000000000000ffffff800000000000000000000000000000000", 1677721600);
		Check("0x000000000000000000000000ffffffffffffffffffffffffffffffffffffffff", "0x000000000000000000000000ffffff8000000000000000000000000000000000", 1610612736);
		Check("0x00000000000000000000000fffffffffffffffffffffffffffffffffffffffff", "0x00000000000000000000000ffffff80000000000000000000000000000000000", 1543503872);
		Check("0x0000000000000000000000ffffffffffffffffffffffffffffffffffffffffff", "0x0000000000000000000000ffffff800000000000000000000000000000000000", 1476395008);
		Check("0x000000000000000000000fffffffffffffffffffffffffffffffffffffffffff", "0x000000000000000000000ffffff8000000000000000000000000000000000000", 1409286144);
		Check("0x00000000000000000000ffffffffffffffffffffffffffffffffffffffffffff", "0x00000000000000000000ffffff80000000000000000000000000000000000000", 1342177280);
		Check("0x0000000000000000000fffffffffffffffffffffffffffffffffffffffffffff", "0x0000000000000000000ffffff800000000000000000000000000000000000000", 1275068416);
		Check("0x000000000000000000ffffffffffffffffffffffffffffffffffffffffffffff", "0x000000000000000000ffffff8000000000000000000000000000000000000000", 1207959552);
		Check("0x00000000000000000fffffffffffffffffffffffffffffffffffffffffffffff", "0x00000000000000000ffffff80000000000000000000000000000000000000000", 1140850688);
		Check("0x0000000000000000ffffffffffffffffffffffffffffffffffffffffffffffff", "0x0000000000000000ffffff800000000000000000000000000000000000000000", 1073741824);
		Check("0x000000000000000fffffffffffffffffffffffffffffffffffffffffffffffff", "0x000000000000000ffffff8000000000000000000000000000000000000000000", 1006632960);
		Check("0x00000000000000ffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00000000000000ffffff80000000000000000000000000000000000000000000", 939524096);
		Check("0x0000000000000fffffffffffffffffffffffffffffffffffffffffffffffffff", "0x0000000000000ffffff800000000000000000000000000000000000000000000", 872415232);
		Check("0x000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x000000000000ffffff8000000000000000000000000000000000000000000000", 805306368);
		Check("0x00000000000fffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00000000000ffffff80000000000000000000000000000000000000000000000", 738197504);
		Check("0x0000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x0000000000ffffff800000000000000000000000000000000000000000000000", 671088640);
		Check("0x000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x000000000ffffff8000000000000000000000000000000000000000000000000", 603979776);
		Check("0x00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00000000ffffff80000000000000000000000000000000000000000000000000", 536870912);
		Check("0x0000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x0000000ffffff800000000000000000000000000000000000000000000000000", 469762048);
		Check("0x000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x000000ffffff8000000000000000000000000000000000000000000000000000", 402653184);
		Check("0x00000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00000ffffff80000000000000000000000000000000000000000000000000000", 335544320);
		Check("0x0000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x0000ffffff800000000000000000000000000000000000000000000000000000", 268435456);
		Check("0x000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x000ffffff8000000000000000000000000000000000000000000000000000000", 201326592);
		Check("0x00ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00ffffff80000000000000000000000000000000000000000000000000000000", 134217728);
		Check("0x0fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00ffffff80000000000000000000000000000000000000000000000000000000", 134217728);
		Check("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", "0x00ffffff80000000000000000000000000000000000000000000000000000000", 134217728);
	}
}
